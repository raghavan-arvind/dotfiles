#!/bin/bash

LOGFILE=/tmp/togglemonitor

# We shouldn't toggle more than once every two seconds
if [ -f $LOGFILE ]; then
    lasttoggle=$(cat $LOGFILE)
    cutoff=$(date -d "2 seconds ago" +%s)

    if (( $lasttoggle > $cutoff )); then
        echo "Called again too soon!"
        exit
    fi
fi

# Save the current time
date +%s > $LOGFILE

if xrandr | rg -q "^DP1 disconnected"; then 
    xrandr --output eDP1 --auto --primary --mode 1920x1080
else 
    if xrandr | rg -q "^eDP1 connected \(" || xrandr | rg -q "^eDP1 connected primary \("; then
        # Main display on
        xrandr --output eDP1 --primary --mode 1920x1080 --output DP1 --off
    else
        # Main display off
        xrandr --output DP1 --primary --mode 1920x1200 --output eDP1 --off
    fi
fi
